<include file="Public/head" />
<style>
.grouptd {
	position: relative;
}

.group {
	display: inline-block;
	width: 100%;
}

.groupselect {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	border: 0;
}
</style>
<body class="no-skin">
	<include file="Public/header" />
	<div class="main-container" id="main-container">
		<script type="text/javascript">
			try {
				ace.settings.check('main-container', 'fixed')
			} catch (e) {
			}
		</script>

		<include file="Public/sidebar" />
		<div class="main-content">
			<div class="main-content-inner">
				<!-- #section:basics/content.breadcrumbs -->
				<include file="Public/breadcrumbs" />

				<!-- /section:basics/content.breadcrumbs -->
				<div class="page-content">
					<include file="Public/set" />

					<!-- /section:settings.box -->
					<div class="row">
						<div class="col-xs-12">
							<!-- PAGE CONTENT BEGINS -->
							<div class="row">
								<form class="form-inline" action="" method="post">
									<a class="btn btn-info" href="{:U('add')}" value="">添加{$model.contenttitile}</a>
										<input type="text" name="keyword" value="" placeholder="请输入文章名称" class="search-keywords">
									<button type="submit" class="btn btn-purple btn-sm">
										<span class="ace-icon fa fa-search icon-on-right bigger-110"></span>
										Search
									</button>
								</form>
							</div>
							<div class="space-4"></div>
							<div class="row">
								<form id="form" method="post" action="{:U('index')}">
									<table class="table table-striped table-bordered table-hover">
										<thead>
											<tr>
												<th>名称</th>
												<th>添加时间</th>
												<th>查看关联小区</th>
												<th class="center">操作</th>
											</tr>
										</thead>
										<tbody>
											<volist name="list" id="val">
											<tr>
												<td>{$val['noticetitle']}</td>
												<td>{$val['createtime']}</td>
												<td><a href="{:U('edit',array('id'=>$val['id']))}">查看小区</a></td>
												<td class="center">
												 <php>echo '<a class="linkOpenModal" href="javascript:void(0);" val="'.$val['id'].'"><i class="fa fa-plus"></i>关联小区</a>';</php>
												<a href="{:U('edit',array('id'=>$val['id']))}"><i class="fa fa-edit"></i>编辑</a>
												<a href="{:U('edit',array('id'=>$val['id']))}"><i class="fa fa-trash"></i>删除</a>
												</td>
											</tr>
											</volist>
										</tbody>
									</table>
								</form>

							</div>
							<!-- PAGE CONTENT ENDS -->
						</div>
						{$page}
						<!-- /.col -->
					</div>
					<!-- /.row -->
				</div>
				<!-- 模态框（Modal） -->
				<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
					aria-labelledby="myModalLabel" aria-hidden="true">
					<input type="hidden" id="hdfnoticeid"/>
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal"
									aria-hidden="true">&times;</button>
								<h4 class="modal-title" id="myModalLabel">选择楼宇</h4>
							</div>
							<div class="modal-body" style="height:100%; overflow:scroll;"><include file="Public/buildingselected" /></div>
							<div class="modal-footer">
							<button type="button" class="btn btn-info" id="btnSave" 
									data-dismiss="modal">保存</button>
								<button type="button" class="btn btn-default"
									data-dismiss="modal">关闭</button>
							</div>
						</div>
						<!-- /.modal-content -->
					</div>
					<!-- /.page-content -->
				</div>
				<!-- /.page-content -->
			</div>
		</div>
		<!-- /.main-content -->
		<include file="Public/footer" />

	</div>
	<!-- /.main-container -->

	<include file="Public/footerjs" />
	<!-- inline scripts related to this page -->
	<script type="text/javascript">
	//打开模态框
	$('.linkOpenModal').click(function(){
		var noticeid=$(this).attr('val');
		$('#hdfnoticeid').val(noticeid);
		bindtreeview();
		removeChild();
		$('#myModal').modal({});
	});
	//关联小区 	
	$('#btnSave').click(function(){
		var zTreeObj = $.fn.zTree.getZTreeObj("treeDemo");
		var checkedNodes = zTreeObj.getCheckedNodes(); 
		 if(checkedNodes.length==0){
			 bootbox.dialog({
	                title: '友情提示：',
	                message: '请选择楼宇',
	                buttons: {
	                    "success": {
	                        "label": "确定",
	                        "className": "btn-info"
	                    }
	                }
	            });
			 return;
		 }else{
			//文章关联小区
			var totalselect = new Array();//选中多少小区
			for (var i = 0; i < checkedNodes.length; i++) {
					totalselect.push(checkedNodes[i].id.substr(1,checkedNodes[i].id.length));
				}
				var sendData = {
					noticeid : $('#hdfnoticeid').val(),
					totalselect:totalselect
				};
				$.ajax({
					type : "post",
					url : "__URL__/addvillagetonotice",
					dataType : "json",
					data : sendData,
					success : function(data) {
						if (data.status == "1") {

						} else {
							bootbox.dialog({
								title : '友情提示：',
								message : data.message,
								buttons : {
									"success" : {
										"label" : "确定",
										"className" : "btn-danger"
									}
								}
							});
						}
					},
					error : function(XMLHttpRequest, textStatus, errorThrown) {
					}
				});
			}
		});

		//删除楼宇只保留小区信息
		function removeChild() {
			var zTreeObj = $.fn.zTree.getZTreeObj("treeDemo");
			var nodes = zTreeObj.getNodes();
			if (nodes && nodes.length > 0) {
				for (var i = 0; i < nodes.length; i++) {
					var first = nodes[i].id.substr(0, 1);
					if (first == "p") {
						zTreeObj.removeChildNodes(nodes[i]);
					}

				}
			}
		}
	</script>
</body>
</html>
