<include file="Public/head" />
<style>
.grouptd {
	position: relative;
}

.group {
	display: inline-block;
	width: 100%;
}

.groupselect {
	position: absolute;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
	border: 0;
}
</style>
<body class="no-skin">
	<include file="Public/header" />
	<div class="main-container" id="main-container">
		<script type="text/javascript">
			try {
				ace.settings.check('main-container', 'fixed')
			} catch (e) {
			}
		</script>

		<include file="Public/sidebar" />
		<div class="main-content">
			<div class="main-content-inner">
				<include file="Public/breadcrumbs" />
				<include file="Public/set" />
				<h2>图文素材</h2>
					<div class="row">
					<div class="col-xs-12">
						<a class="btn btn-info" href="{:U('add')}" value="">新增</a>
						<div>
							<table class="table table-striped table-bordered table-hover">
								<thead>
									<tr>
										<th>图文</th>
										<th>添加时间</th>
										<th class="center">操作</th>
									</tr>
								</thead>
								<volist name="list" id="val" empty="暂时无数据">
								<tbody>
									<tr>
										<td><img height=150 weight=278 src="__APP__{$val['newspicture']}"/></td>
										<td>{$val['createtime']}</td>
										<td class="center">
											<php> echo '<a class="blue edit" href="'.U('edit',array('id'=>$val['id'])).'"
											val="'.$val['id'].'" title="修改">修改</a>';</php>
											<php> echo '<a class="blue deletenews" href="javascript:void(0);"
											val="'.$val['id'].'" title="删除">删除</a>';</php>
										</td>
									</tr>
								</tbody>
									</volist>
							</table>
						</div>
						{$page}
						<!-- PAGE CONTENT ENDS -->
					</div>
					<!-- /.col -->
				</div>
				<!-- /.row -->
				<div class="modal fade" id="theModal" tabindex="-1" role="dialog"
					aria-labelledby="theModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal"
									aria-hidden="true">&times;</button>
								<h4 class="modal-title" id="myModalLabel">添加模块</h4>
							</div>
							<div class="modal-body" style="height: 100%">
								<input type='hidden' id='hdfcontentid' value=''>
								<div class="row">
									<div class="form-group">
										<label class="col-sm-2 control-label no-padding-right"
											for="form-field-10">模块名称：</label>
										<div class="col-sm-6">
											<input type="text" name="contenttitile" id="contenttitile"
												placeholder="模块名称" class="col-xs-12 col-sm-12" value="">
										</div>
									</div>
								</div>
								<div style="height: 20px"></div>
								<div class="row">
									<div class="form-group">
										<label class="col-sm-2 control-label no-padding-right"
											for="form-field-10">模块类型：</label>
										<div class="col-sm-6">
											<select id="contenttype" name="contenttype"
												class="col-xs-10 col-sm-5">
												<volist name="contenttype" id="vo" empty="暂时无数据">
												<option value='{$vo.dict_value}'>{$vo.dict_key}</option>
												</volist>
											</select>
										</div>
									</div>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-info submit"
									id="savecontent" data-dismiss="modal">保存</button>
								<button type="button" class="btn btn-default"
									data-dismiss="modal">关闭</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- /.main-content -->
	<include file="Public/footer" />

	<!-- /.main-container -->
	<include file="Public/footerjs" />
	<!-- inline scripts related to this page -->
<script type="text/javascript">
		$(function(){
			//保存文章
			$('#savecontent').click(function(){
				var id=$('#hdfcontentid').val();
				var contenttitile=$('#contenttitile').val();
				var contenttype=$('#contenttype').val();
				var sendData = {
						contenttitile :contenttitile,
						contenttype:contenttype,
						id:id
					};
				$.ajax({
					type : "post",
					url : "__URL__/updatecontent",
					dataType : "json",
					data : sendData,
					success : function(data) {
						if (data.status == "1") {
							bootbox.alert({
                                buttons: {
                                    ok: {
                                        label: '确定',
                                        className: 'btn-danger'
                                    }
                                },
                                message: data.message,
                                callback: function () {
                                    window.location.reload(true);
                                },
                                title: "友情提示",
                            });
						} 
					},
					error : function(XMLHttpRequest, textStatus, errorThrown) {
					}
				});
			});
			//编辑模态框
			$('.editcontent').click(function(){
		        var id = $(this).attr('val');
		        var contenttitile = $(this).attr('contenttitile');
		        var contenttype = $(this).attr('contenttype');
		        $('#contenttitile').val(contenttitile);
		        $('#contenttype').val(contenttype);
		        $('#hdfcontentid').val(id);
				$('#theModal').modal({});
			});
			//新增模态框
			$('#addcontent').click(function(){
				$('#contenttitile').val('');
				$('#hdfcontentid').val('');
			    $('#contenttype option:first').prop('selected','selected');
				$('#theModal').modal({});
			});
			//删除文章
			 $(".deletenews").on('click', function () {
		          var obj = $(this);
		          var id = obj.attr('val');
		          bootbox.confirm({
		              title: "系统提示",
		              message: "是否要删除该图文素材？",
		              callback: function (result) {
		                  if (result) {
		                      $.get("{:U('deletecontent')}?id=" + id, function (response) {
		                    	  if (response.status == 1) {
		                              bootbox.alert({
		                                  buttons: {
		                                      ok: {
		                                          label: '确定',
		                                          className: 'btn-danger'
		                                      }
		                                  },
		                                  message: '恭喜，删除成功！',
		                                  callback: function () {
		                                	
		                                      window.location.reload(true);
		                                  },
		                                  title: "友情提示",
		                              });
		                              return;
		                          }else{
		                        	  bootbox.dialog({
		                                  message: response.message,
		                                  buttons: {
		                                      "success": {
		                                          "label": "确定",
		                                          "className": "btn-danger"
		                                      }
		                                  }
		                              });
		                              return;
		                          } 
		                      });
		                  } else {
		                      return true;
		                  }
		              },
		              buttons: {
		                  "cancel": {"label": "取消"},
		                  "confirm": {
		                      "label": "确定",
		                      "className": "btn-danger"
		                  }
		              }
		          });
		      });
		});
		
	</script>
</body>
</html>
